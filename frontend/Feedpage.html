<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Feed Page</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-4Q6Gf2aSP4eDXB8Miphtr37CMZZQ5oXLH2yaXMJ2w8e2ZtHTl7GptT4jmndRuHDT" crossorigin="anonymous">
    <link href="./Feedpage.css" rel="stylesheet">
  </head>
  <body>
    <div class="text-end p-2">
        <a href="./Post.html" class="btn btn-primary w-20 text-white"> New Post</a>
        <a href="./index.html" class="btn btn-danger w-20 text-white"> Logout </a>
    </div>

    <div class="allposts">
        <!-- Posts will be dynamically inserted here -->
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/js/bootstrap.bundle.min.js" integrity="sha384-j1CDi7MgGQ12Z7Qab0qlWQ/Qqz24Gc6BM0thvEMVjHnfYGF0rmFCozFSxQBxwHKO" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js" integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/js/bootstrap.min.js" integrity="sha384-RuyvpeZCxMJCqVUGFI0Do1mQrods/hhxYlcVfGPOfQtPJh0JCw12tUAZ/Mv10S7D" crossorigin="anonymous"></script>

    <script>
  async function loadUserPosts() {
    const userID = localStorage.getItem('userID');

    if (!userID) {
      alert('Please log in first.');
      window.location.href = './index.html';
      return;
    }

    try {
      console.log('Fetching posts for userID â†’', userID); // ðŸ‘ˆ log before fetch

      const response = await fetch(`https://my-diary-g58l.onrender.com/getMyPosts/${userID}`, {
        method: 'GET',
        headers: {
          'Content-Type': 'application/json'
        }
      });

      console.log('Response status:', response.status); // ðŸ‘ˆ log status

      const posts = await response.json();

      console.log('Response data:', posts); // ðŸ‘ˆ log the actual data

      const container = document.querySelector('.allposts');
      container.innerHTML = '';

      if (posts.length === 0) {
        container.innerHTML = '<p class="text-center">No posts found for this user.</p>';
        return;
      }

     posts.forEach(post => {
  container.innerHTML += `
    <div class="post border border-dark m-auto p-4 mb-3">
      <h2>${post.postTitle || 'Untitled'}</h2>
      ${post.postImage ? `<img src="http://localhost:5000/${post.postImage}" class="img-fluid mb-3" alt="Post image">` : ''}
      <!--<p>${post.postdescription || 'No content available.'}</p>-->
      <a href="./Dedicatedpage.html?postID=${post._id}" class="btn btn-primary text-white">View Post</a>
    </div>
  `;
});

          
    } catch (err) {
      console.error('Error fetching posts:', err); // ðŸ‘ˆ log any fetch or parsing errors
      alert('Error fetching posts');
    }
  }

  window.addEventListener('DOMContentLoaded', loadUserPosts);
</script>

  </body>
</html>
